// FPS and Ping Counter System
(function() {
  let frameCount = 0;
  let lastTime = performance.now();
  let currentFPS = 0;
  let fpsPanel = null;
  let fpsDisplay = null;
  let pingDisplay = null;

  // Initialize FPS/Ping info panel
  function initFPSPanel() {
    if (fpsPanel) return;

    // Create panel container
    fpsPanel = document.createElement('div');
    fpsPanel.id = 'fps-ping-panel';
    fpsPanel.style.cssText = `
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #00ff00;
      font-family: monospace;
      font-size: 12px;
      padding: 8px 12px;
      border: 1px solid #00ff00;
      border-radius: 4px;
      z-index: 10000;
      min-width: 100px;
      user-select: none;
      pointer-events: none;
    `;

    // Create FPS display
    fpsDisplay = document.createElement('div');
    fpsDisplay.id = 'fps-display';
    fpsDisplay.textContent = 'FPS: 0';
    fpsDisplay.style.marginBottom = '4px';

    // Create Ping display
    pingDisplay = document.createElement('div');
    pingDisplay.id = 'ping-display';
    pingDisplay.textContent = 'Ping: --ms';

    fpsPanel.appendChild(fpsDisplay);
    fpsPanel.appendChild(pingDisplay);
    document.body.appendChild(fpsPanel);
  }

  // Update FPS counter
  function updateFPS() {
    frameCount++;
    const currentTime = performance.now();
    const elapsedTime = currentTime - lastTime;

    if (elapsedTime >= 1000) {
      currentFPS = Math.round((frameCount * 1000) / elapsedTime);
      frameCount = 0;
      lastTime = currentTime;

      if (fpsDisplay) {
        fpsDisplay.textContent = `FPS: ${currentFPS}`;
      }
    }

    requestAnimationFrame(updateFPS);
  }

  // Update Ping display
  function updatePing() {
    if (pingDisplay && typeof gameFrame !== 'undefined' && gameFrame.connection) {
      const ping = gameFrame.connection.ping || 0;
      pingDisplay.textContent = `Ping: ${ping}ms`;
    }
    setTimeout(updatePing, 500); // Update ping every 500ms
  }

  // Public API to initialize the system
  window.initFPSPingCounter = function() {
    initFPSPanel();
    updateFPS();
    updatePing();
  };

  // Auto-initialize if gameFrame is available
  if (typeof gameFrame !== 'undefined') {
    window.initFPSPingCounter();
  } else {
    // Wait for gameFrame to be available
    const checkInterval = setInterval(function() {
      if (typeof gameFrame !== 'undefined') {
        window.initFPSPingCounter();
        clearInterval(checkInterval);
      }
    }, 100);
  }
})();
